<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Vision.AI | Diagnosis</title>
    <link rel="icon" href="img/favicon.png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- loader.css -->
    <link rel="stylesheet" href="css/loader.css">
    <!-- animate CSS -->
    <link rel="stylesheet" href="css/animate.css">
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="css/flaticon.css">
    <!-- style CSS -->
    <link rel="stylesheet" href="css/style.css">
    <!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="auth/images/icons/favicon.png"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/fonts/iconic/css/material-design-iconic-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/vendor/animate/animate.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="auth/vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/vendor/select2/select2.min.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="auth/vendor/daterangepicker/daterangepicker.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/css/util.css">
	<link rel="stylesheet" type="text/css" href="auth/css/main.css">
<!--===============================================================================================--> 
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
</head>

<body onload="load_checker()">
    <!--::header part start::-->
    <header class="main_menu home_menu">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <a class="navbar-brand" href="index.html"> <img src="img/logo.png" alt="logo"> </a>
                        <div class="collapse navbar-collapse main-menu-item justify-content-center"
                            id="navbarSupportedContent">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a class="nav-link" href="index.html">Diagnosis</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="index.html">Find a doctor</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="index.html">Appointments</a>
                                </li>
                            </ul>
                        </div>
                        <li class="nav-item dropdown">
                            <p class="nav-link dropdown-toggle" id="navbarDropdown_1"
                                        role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Account
                            </p>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown_1">
                                <a class="dropdown-item" href="blog.html">My Profile</a>
                                <p class="dropdown-item" onClick="logout()">Logout</p>
                            </div>
                        </li>
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <!-- Header part end-->

    <!-- app part start-->
	   <div class="limiter">
            <div class="container-login100">
                <div class="wrap-login100">
                    <div class="login100-form validate-form">
                        <span class="login100-form-title p-b-26">
                            Upload the fundus scan
                        </span>
                            <input onchange="encode();" class="input100" type="file" name="fundus_image" id="fundus_image" required="required">

                        <div class="container-login100-form-btn">
                            <div class="wrap-login100-form-btn">
                                <div class="login100-form-bgbtn"></div>
                                <button class="login100-form-btn" onClick="upload()">
                                    Upload & Go
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
	<!-- app part end-->
    <!-- footer part start-->
    <footer class="footer-area">
        <div class="footer section_padding">
            <div class="container">
                <div class="row justify-content-between">
                    <div class="col-xl-2 col-md-4 col-sm-6 single-footer-widget">
                        <a href="#" class="footer_logo"> <img src="img/logo.png" alt="#"> </a>
                        <p>Diabetic Retinopathy detection 
                        using Deep Learning. </p>
                    </div>
                    <div class="col-xl-2 col-sm-6 col-md-4 single-footer-widget">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href="#">Home</a></li>
                            <li><a href="#"> Our Services</a></li>
                        </ul>
                    </div>
                    <div class="col-xl-2 col-sm-6 col-md-4 single-footer-widget">
                        <h4>Developed by</h4>
                        <ul>
                            <li><a href="#">Devendra Kushwah</a></li>
                            <li><a href="#">Arpit Motwani</a></li>
                            <li><a href="#">Sanjeevani Oswal</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="copyright_part">
            <div class="container">
                <div class="row align-items-center">
                    <p class="footer-text m-0 col-lg-8 col-md-12"><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved
 | Vision.AI</p>
                </div>
            </div>
        </div>
    </footer>
    <!-- footer part end-->
<div class="loading" id="loader" style="visibility:hidden;">Loading</div>
        <!-- loader part starts-->
    <!-- loader part ends-->        
<script type="text/javascript">
    var base64string = null;
    function load_checker(){
        if (localStorage.getItem("auth_token")==null) {
            localStorage.clear();
            Swal.fire({
                  type: 'error',
                  title: 'Login to access this page',
                  allowOutsideClick: false,
                  confirmButtonText : 'Login Now'
                }).then((result) => {
                    if (result.value) {
                            window.location="login.html";
                    }})
        }
    }

    function loading_start(){
        var loader = document.getElementById("loader");
        loader.style.visibility = "visible";
    }

    function loading_end(){
        var loader = document.getElementById("loader");
        loader.style.visibility= "hidden";
    }

    function logout(){
        localStorage.clear();
        Swal.fire({
          position: 'top-end',
          type: 'success',
          title: 'Logged out successfully',
          showConfirmButton: false,
          timer: 1200
        }).then((result) => {
            window.location="login.html";
        })
    }

    function encode() {
        var selectedfile = document.getElementById("fundus_image").files;
        if (selectedfile.length > 0) {
          var imageFile = selectedfile[0];
          var fileReader = new FileReader();
          fileReader.onload = function(fileLoadedEvent) {
            var srcData = fileLoadedEvent.target.result;
            base64string = srcData
            //console.log(base64string);
          }
          fileReader.readAsDataURL(imageFile);
        }
      }

      function upload(){
        if(base64string !== null){
            loading_start();
            var request = new XMLHttpRequest();
            request.onreadystatechange = function() {
                if (request.readyState == 4){
                    loading_end();
                    var response = JSON.parse(this.responseText);
                    console.log(response);
                }
            };
            request.open("POST", "http://localhost:8000/api/vision/detect_dr", false);
            request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            request.setRequestHeader('Authorization', 'Token ' + localStorage.getItem("auth_token"));
            request.send("image_base64="+base64string);
        }
        else{
            Swal.fire({
              type: 'error',
              title: 'Oops...',
              text: 'Select an image first',
              allowOutsideClick: false,
            })
        }
      } 
</script>
</body>

</html>