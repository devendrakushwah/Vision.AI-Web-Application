<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Vision.AI | Login</title>
    <link rel="icon" href="img/favicon.png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- animate CSS -->
    <link rel="stylesheet" href="css/animate.css">
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="css/flaticon.css">
    <!-- style CSS -->
    <link rel="stylesheet" href="css/style.css">
    <!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="auth/images/icons/favicon.png"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/fonts/iconic/css/material-design-iconic-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/vendor/animate/animate.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="auth/vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/vendor/select2/select2.min.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="auth/vendor/daterangepicker/daterangepicker.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="auth/css/util.css">
	<link rel="stylesheet" type="text/css" href="auth/css/main.css">
<!--===============================================================================================-->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
</head>

<body onload="load_checker()">
    <!--::header part start::-->
    <header class="main_menu home_menu">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <a class="navbar-brand" href="index.html"> <img src="img/logo.png" alt="logo"> </a>
                        <div class="collapse navbar-collapse main-menu-item justify-content-center"
                            id="navbarSupportedContent">
                            <ul class="navbar-nav align-items-center">
                                <li class="nav-item active">
                                    <a class="nav-link" style="color: white;" href="index.html">.</a>
                                </li>
                            </ul>
                        </div>
                        <a class="btn_2 d-none d-lg-block" href="signup.html">SIGN UP</a>
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <!-- Header part end-->

    <!-- login part start-->
	<div class="limiter">
			<div class="container-login100">
				<div class="wrap-login100">
					<div class="login100-form validate-form">
						<span class="login100-form-title p-b-26">
							Welcome Back!
						</span>
						<div class="wrap-input100 validate-input" data-validate = "Valid email is: a@b.c">
							<input id="username" class="input100" type="text" name="username" required="required">
							<span class="focus-input100" data-placeholder="Username"></span>
						</div>

						<div class="wrap-input100 validate-input" data-validate="Enter password">
							<span class="btn-show-pass">
								<i class="zmdi zmdi-eye"></i>
							</span>
							<input id="password" class="input100" type="password" name="password" required="required">
							<span class="focus-input100" data-placeholder="Password"></span>
						</div>

						<div class="container-login100-form-btn">
							<div class="wrap-login100-form-btn">
								<div class="login100-form-bgbtn"></div>
								<button class="login100-form-btn" onClick="login()">
									Login
								</button>
							</div>
						</div>
					<div class="text-center p-t-115">
						<span class="txt1">
							Don't have an account?
						</span>

						<a class="txt2" href="signup.html">
							Sign up
						</a>
					</div>
					</div>
				</div>
			</div>
		</div>
		

		<div id="dropDownSelect1"></div>
	<!-- login part end-->		

    <!-- footer part start-->
    <footer class="footer-area">
        <div class="footer section_padding">
            <div class="container">
                <div class="row justify-content-between">
                    <div class="col-xl-2 col-md-4 col-sm-6 single-footer-widget">
                        <a href="#" class="footer_logo"> <img src="img/logo.png" alt="#"> </a>
                        <p>Diabetic Retinopathy detection 
                        using Deep Learning. </p>
                    </div>
                    <div class="col-xl-2 col-sm-6 col-md-4 single-footer-widget">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href="#">Home</a></li>
                            <li><a href="#"> Our Services</a></li>
                        </ul>
                    </div>
                    <div class="col-xl-2 col-sm-6 col-md-4 single-footer-widget">
                        <h4>Developed by</h4>
                        <ul>
                            <li><a href="#">Devendra Kushwah</a></li>
                            <li><a href="#">Arpit Motwani</a></li>
                            <li><a href="#">Sanjeevani Oswal</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="copyright_part">
            <div class="container">
                <div class="row align-items-center">
                    <p class="footer-text m-0 col-lg-8 col-md-12">
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved
 | Vision.AI</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- footer part end-->
    <script type="text/javascript">
        function load_checker(){
            if (localStorage.getItem("auth_token")!==null) {
                Swal.fire({
                    title: 'Hold on!!!',
                    text: "Already logged in as "+localStorage.getItem("username"),
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    cancelButtonText:"Logout",
                    allowOutsideClick: false,
                    confirmButtonText: 'Continue as '+localStorage.getItem("username")
                }).then((result) => {
                    if (result.value) {
                        window.location="diagnosis.html";
                    }
                    else{
                        localStorage.clear();
                    }
                })
            }
        }

        function login(){
            var username = document.getElementById("username").value;
            var password = document.getElementById("password").value;
            var request = new XMLHttpRequest();
            request.onreadystatechange = function() {
                if (request.readyState == 4){
                    var response = JSON.parse(this.responseText);
                    if("token" in response){
                        localStorage.setItem("auth_token", response["token"]);
                        get_user_details(localStorage.getItem("auth_token"));
                        window.location="diagnosis.html";
                    }
                    else{
                        localStorage.clear();
                            Swal.fire({
                              type: 'error',
                              title: 'Oops...',
                              text: 'Incorrect credentials combination',
                              allowOutsideClick: false,
                            })
                    }
                }
            };
            request.open("POST", "http://localhost:8000/api/accounts/generate_user_token", false);
            request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            request.send("username="+username+"&password="+password);
        }

        function get_user_details(token){
            var request = new XMLHttpRequest();
            request.onreadystatechange = function() {
                if (request.readyState == 4){
                    response = JSON.parse(this.responseText);
                    localStorage.setItem("username", response["username"]);
                    localStorage.setItem("email", response["email"]);
                    localStorage.setItem("first_name", response["first_name"]);
                    localStorage.setItem("last_name", response["last_name"]);
                }
            };
            request.open("GET", "http://localhost:8000/api/accounts/get_my_details", false);
            request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            request.setRequestHeader('Authorization', 'Token ' + token);
            request.send();
        }

    </script>

</body>

</html>